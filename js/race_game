// js/race_game.js
document.addEventListener('DOMContentLoaded', () => {
    const questions = [
        { question: "What is the capital of Egypt?", answers: ["Cairo", "Giza", "Alexandria", "Luxor"], correct: 0 },
        { question: "Which planet is known as the Red Planet?", answers: ["Earth", "Mars", "Jupiter", "Venus"], correct: 1 },
        { question: "How many continents are there?", answers: ["5", "6", "7", "8"], correct: 2 },
        { question: "What gas do plants breathe in?", answers: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Helium"], correct: 2 },
        { question: "What is the largest mammal?", answers: ["Elephant", "Giraffe", "Blue Whale", "Great White Shark"], correct: 2 },
        { question: "Where are the pyramids of Giza?", answers: ["Sudan", "Mexico", "Egypt", "Peru"], correct: 2 },
        { question: "What is H2O?", answers: ["Salt", "Air", "Water", "Sand"], correct: 2 },
        { question: "Which shape has 3 sides?", answers: ["Square", "Triangle", "Circle", "Rectangle"], correct: 1 },
        { question: "What is the boiling point of water?", answers: ["50째C", "100째C", "0째C", "200째C"], correct: 1 },
        { question: "Who first walked on the moon?", answers: ["Buzz Aldrin", "Yuri Gagarin", "Neil Armstrong", "Michael Collins"], correct: 2 }
    ];
    let currentQuestionIndex = 0, playerPosition = 10, aiPosition = 10, timerInterval;
    const playerCar = document.getElementById('player-car'), aiCar = document.getElementById('ai-car'),
          questionText = document.getElementById('question-text'), answerButtonsContainer = document.getElementById('answer-buttons'),
          questionCounter = document.getElementById('question-counter'), timerDisplay = document.getElementById('timer');

    window.startGame = function() {
        currentQuestionIndex = 0; playerPosition = 10; aiPosition = 10;
        updateCarPositions(); displayQuestion();
    }
    function displayQuestion() {
        if (currentQuestionIndex >= questions.length) { endGame(); return; }
        clearInterval(timerInterval);
        let timeLeft = 20;
        timerDisplay.textContent = `Time Left: ${timeLeft}s`;
        timerInterval = setInterval(() => {
            timeLeft--; timerDisplay.textContent = `Time Left: ${timeLeft}s`;
            if (timeLeft <= 0) { handleAnswer(-1); }
        }, 1000);
        questionCounter.textContent = `Question ${currentQuestionIndex + 1} of 10`;
        const q = questions[currentQuestionIndex];
        questionText.textContent = q.question;
        answerButtonsContainer.innerHTML = '';
        q.answers.forEach((answer, index) => {
            const button = document.createElement('button');
            button.textContent = answer; button.classList.add('answer-btn');
            button.onclick = () => handleAnswer(index);
            answerButtonsContainer.appendChild(button);
        });
    }
    function handleAnswer(selectedIndex) {
        clearInterval(timerInterval);
        const correctAnswerIndex = questions[currentQuestionIndex].correct;
        const buttons = document.querySelectorAll('.answer-btn');
        buttons.forEach(btn => btn.disabled = true);
        if (selectedIndex === correctAnswerIndex) {
            playerPosition += 9; buttons[selectedIndex].style.backgroundColor = '#4CAF50';
        } else {
            playerPosition += 2;
            if(selectedIndex !== -1) buttons[selectedIndex].style.backgroundColor = '#f44336';
        }
        if (Math.random() > 0.3) { aiPosition += 9; } else { aiPosition += 2; }
        updateCarPositions();
        currentQuestionIndex++;
        setTimeout(displayQuestion, 2000);
    }
    function updateCarPositions() {
        playerCar.style.left = `${playerPosition}%`; aiCar.style.left = `${aiPosition}%`;
    }
    function endGame() {
        let resultText = (playerPosition > aiPosition) ? 'You Win! Congratulations!' : (aiPosition > playerPosition) ? 'The AI Wins! Try again!' : "It's a Tie!";
        questionText.textContent = resultText;
        answerButtonsContainer.innerHTML = '<button class="answer-btn" onclick="startGame()">Play Again?</button>';
        questionCounter.textContent = "Race Finished!";
    }
});